<!--A Design by W3layouts
Author: W3layout
Author URL: http://w3layouts.com
License: Creative Commons Attribution 3.0 Unported
License URL: http://creativecommons.org/licenses/by/3.0/
-->
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<title>Registration / Login form Flat Responsive Widget Template :: w3layouts</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="keywords" content="Registration / Login form template Responsive, Login form web template,Flat Pricing tables,Flat Drop downs  Sign up Web Templates, Flat Web Templates, Login sign up Responsive web template, SmartPhone Compatible web template, free WebDesigns for Nokia, Samsung, LG, Sony Ericsson, Motorola web design" />
<script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
<!-- Custom CSS -->
<link th:href="@{/static/css/style-login.css}" rel='stylesheet' type='text/css' />
<!-- font CSS --><!--
<link href='//fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
<link href="//fonts.googleapis.com/css?family=Archivo+Black" rel="stylesheet">-->
<link href="//fonts.googleapis.com/css?family=Signika:300,400,700" rel="stylesheet">
<link href="//fonts.googleapis.com/css?family=Roboto+Condensed:400,700" rel="stylesheet">

<!--font CSS-->
</head>
<body class="dashboard-page" style="height: 100%;width: 100%;">
<div class="main-grid">
    <div class="agile-grids">	
        <!-- validation -->
        <div class="grids">
            
            <div class="forms-grids" style="margin-top: 100px">
                <div class="progressbar-heading grids-heading">
                    <h2 id="title">registration / login form</h2>
                </div>
                <div class="forms3">
                <div class="w3agile-validation w3ls-validation">
                    <div class="panel panel-widget agile-validation register-form">
                        <div class="validation-grids widget-shadow" data-example-id="basic-forms"> 
                            <div class="input-info">
                                <h3>注册表单 :</h3>
                            </div>
                            <div class="form-body form-body-info">
                                <form name="registerForm" data-toggle="validator" novalidate="" action="#" method="post">
                                    <div class="form-group valid-form">
                                        <input type="text" class="form-control" id="inputName" name="Username" placeholder="Username" required="">
                                    </div>
                                    <div class="form-group has-feedback">
                                        <input type="email" class="form-control inputEmail" name="Email" placeholder="Email" data-error="无效的邮箱地址" required="">
                                        <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                                        <span class="help-block with-errors">请输入有效的邮箱地址</span>
                                    </div>
                                    <div class="form-group">
                                      <input type="password" data-toggle="validator" data-minlength="6" class="form-control inputPassword" name="Password" placeholder="Password" required="">
                                      <span class="help-block">最少6位数</span>
                                    </div>
                                    <div class="form-group">
                                      <input type="password" class="form-control" id="inputPasswordConfirm" data-match=".inputPassword" data-match-error="输入的密码不一致" name="Confirm password" placeholder="Confirm password" required="">
                                      <div class="help-block with-errors"></div>
                                    </div>
                                    <div class="form-group">
                                        <div class="radio">
                                            <label>
                                            <input type="radio" name="gender" required="" value="1">
                                            男
                                            </label>
                                        </div>
                                        <div class="radio">
                                            <label>
                                              <input type="radio" name="gender" required="" value="2">
                                              女
                                            </label>
                                        </div>
                                        <a style="color: white;" id="back">  ＜＜已有账号，返回登录界面</a>
                                    </div>
                                    <div class="form-group">
                                        <!--<div class="checkbox">-->
                                            <!--<label>-->
                                                <!--<input type="checkbox" data-error="Before you wreck yourself" required="">-->
                                                <!--I have read and accept terms of use.-->
                                            <!--</label>-->
                                            <!--<div class="help-block with-errors"></div>-->
                                        <!--</div>-->
                                    </div>
                                    <div class="form-group">
                                        <button type="button" class="btn btn-primary" onclick="register()">Submit</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <!--默认显示-->
                    <div class="panel panel-widget agile-validation">
                        <div class="validation-grids validation-grids-right login-form">
                            <div class="widget-shadow login-form-shadow" data-example-id="basic-forms"> 
                                <div class="input-info">
                                    <h3>请输入账户与密码:</h3>
                                </div>
                                <div class="form-body form-body-info">
                                    <form name="loginForm" data-toggle="validator" novalidate="" action="#" method="post">
                                        <div class="form-group has-feedback">
                                            <input type="email" class="form-control inputEmail" name="Name" placeholder="Enter Your Email" data-error="Bruh, that email address is invalid" required="">
                                            <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                                        </div>
                                        <div class="form-group">
                                            <input type="password" data-toggle="validator" data-minlength="6" class="form-control inputPassword" name="Password" placeholder="Password" required="">
                                        </div>
                                        <div class="bottom">
                                            <div class="form-group">
                                                <div class="checkbox">
                                                    <label>
                                                        <input type="checkbox" data-error="Before you wreck yourself" required="">
                                                        Remember me
                                                    </label>
                                                    <div class="help-block with-errors"></div>
                                                </div>
                                                <div style="color: white;"><a id="register" >注册账户</a>/<a id="forgetPwd" >忘记密码?</a></div>
                                            </div>
                                            <div class="form-group">
                                                <button  class="btn btn-primary" onclick="login()">Login</button>
                                            </div>
                                            <div class="clearfix"> </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="clear"> </div>
                </div>
            </div>
        </div>
        <!-- //validation -->
    </div>
</div>
<!-- footer -->
<!--<div class="footer">-->
    <!--<p>© 2016 Registration / Login form . All Rights Reserved . Design by <a href="http://w3layouts.com/" target="_blank">W3layouts</a></p>-->
<!--</div>-->
<!-- //footer -->
<!-- input-forms -->


<script th:src="@{/static/js/jquery-3.3.1.min.js}"></script>
<script th:src="@{/static/js/valida.2.1.6.min.js}"></script>
<script th:src="@{/static/js/validator.min.js}"></script>
<script th:src="@{/static/js/crypto-js.js}"></script>
<script th:src="@{/static/js/api/common-api.js}"></script>

<script type="text/javascript" >

    $(document).ready(function() {

        // show Valida's version.
        $('#version').valida( 'version' );

        // Exemple 1
        $('.valida').valida();

        // setup the partial validation
        $('#partial-1').on('click', function( ev ) {
            ev.preventDefault();
            $('#res-1').click(); // clear form error msgs
            $('form').valida('partial', '#field-1'); // validate only field-1
            $('form').valida('partial', '#field-1-3'); // validate only field-1-3
        });
        
        
        $('.register-form').hide();
        $('#title').html("欢迎登录");
        
        $('#register').click(function () {
            $('.login-form').hide();
            $('.register-form').show();
            $('#title').html("请注册");
        });
        
        $('#back').click(function () {
            $('.register-form').hide();
            $('.login-form').show();
        });
    });
 
 
 function login() {
     
    event.preventDefault();//阻止页面在提交后刷新
    
    var name = document.forms["loginForm"]["Name"].value;
    if (name == null || name == "") {
        alert("请输入登录名");
        return false;
    }

    var pwd = document.forms["loginForm"]["Password"].value;
    if (pwd == null || pwd == "") {
        alert("请输入密码");
        return false;
    }
    
    var params = new Map();
    // params.set('loginName', 'admin');
    // params.set('password', '123456');
    params.set('loginName', name);
    params.set('password', encryptPwd(pwd));
    var sign = getBackendSignature(params);
    
    params.set('sign',sign);
    var jsonObj = {};
    params.forEach(function(value, key) {
      jsonObj[key] = value;
    });
    
    $.ajax({
        url: "http://localhost:20011/user/login/online",
        method: "POST",
        data: JSON.stringify(jsonObj),
        async: true,
        dataType: "json",
        contentType: "application/json;charset=UTF-8",
        beforeSend: function(XHR) {
            XHR.setRequestHeader("Access-Control-Allow-Origin","*");
            // XHR.setRequestHeader("userId", encodeURIComponent(userInfo.userId));
        },
        success: function (data) {
            
            if(data.code == 1000){
                // 设置全局参数
                localStorage.setItem('userId', data.data.userId);
                localStorage.setItem('accessToken', data.data.accessToken);
                window.location.href="http://localhost:30000/web/index";
            }else{
                 alert(data.message);
            }
        },
        error: function (data) {
            console.log("请求错误："+data.statusText);
        }

    });
}	

function register() {
     
    event.preventDefault();//阻止页面在提交后刷新
    
    var name = document.forms["registerForm"]["Username"].value;
    if (name == null || name == "") {
        alert("请输入登录名");
        return false;
    }
    
    var email = document.forms["registerForm"]["Email"].value;
    if (email == null || email == "") {
        alert("请输入邮箱");
        return false;
    }

    var pwd = document.forms["registerForm"]["Password"].value;
    if (pwd == null || pwd == "") {
        alert("请输入密码");
        return false;
    }
    
    var cPwd = document.forms["registerForm"]["Confirm password"].value;
    if(cPwd == null || cPwd == ""){
        alert("请输入确认密码");
        return false;
    }
    
    if(pwd != cPwd){
        alert("两次输入的密码不一致，请确认");
        return false;
    }
    
    var sex = $("input[type='radio']:checked").val();
    
    var params = new Map();
    params.set('userName', "client"+Math.random().toString(18).substr());
    params.set('loginName', name);
    params.set('email', email);
    params.set('loginPassword', encryptPwd(pwd));
    params.set('sex', sex == null ? 1 : sex);
    var sign = getBackendSignature(params);
    
    params.set('sign',sign);
    var jsonObj = {};
    params.forEach(function(value, key) {
      jsonObj[key] = value;
    });
    
    $.ajax({
        url: "http://localhost:20011/user/createUser",
        method: "POST",
        data: JSON.stringify(jsonObj),
        async: true,
        dataType: "json",
        contentType: "application/json;charset=UTF-8",
        beforeSend: function(XHR) {
            XHR.setRequestHeader("Access-Control-Allow-Origin","*");
        },
        success: function (data) {
            
            if(data.code == 1000){
                // 设置全局参数
                alert("已注册成功，请登录");
                $(document).ready(function() {
                   $('.register-form').hide(); 
                   $('.login-form').show(); 
                });
            }else{
                 alert(data.message);
            }
        },
        error: function (data) {
            console.log("请求错误："+data.statusText);
        }

    });
}	

</script>
<!-- //input-forms -->
<!--validator js}-->

<!--//validator js}-->
</body>
</html>
